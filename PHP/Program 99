<?php
session_start(); // (a) Start or resume a session

// ----------------- PART 1: Session Counter -----------------
if (!isset($_SESSION['counter'])) {
    // (b) No pre-existing entry → new session
    $_SESSION['counter'] = 0;
}

// (c) Increment visit counter
$_SESSION['counter']++;

// (d) Store it back into $_SESSION (already done above)

// Generate link with session ID
$self_link = $_SERVER['PHP_SELF'] . "?". SID;

echo "<h2>Session Visit Counter</h2>";
echo "You have visited this page <b>" . $_SESSION['counter'] . "</b> times.<br>";
echo "<a href='$self_link'>Reload Page with Session ID</a><hr>";

// ----------------- PART 2: File Upload Restriction -----------------
$uploadDir = "uploads/";

if ($_SERVER['REQUEST_METHOD'] == "POST" && isset($_FILES['userfile'])) {
    $targetFile = $uploadDir . basename($_FILES["userfile"]["name"]);

    // (f) Restrict duplicate upload
    if (file_exists($targetFile)) {
        echo "<p style='color:red;'>❌ Error: This file already exists! Please upload another file.</p>";
    } else {
        if (move_uploaded_file($_FILES["userfile"]["tmp_name"], $targetFile)) {
            echo "<p style='color:green;'>✅ File '" . basename($_FILES["userfile"]["name"]) . "' uploaded successfully.</p>";
        } else {
            echo "<p style='color:red;'>❌ File upload failed.</p>";
        }
    }
}
?>

<!DOCTYPE html>
<html>
<head>
    <title>Session & File Upload Restriction</title>
</head>
<body>
    <h2>Upload a File</h2>
    <form method="post" enctype="multipart/form-data">
        Select file: <input type="file" name="userfile" required>
        <input type="submit" value="Upload">
    </form>
</body>
</html>
